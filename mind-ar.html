<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AR Беларусь (MindAR)</title>
    
    <!-- Подключение MindAR -->
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image.prod.js"></script>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
    
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
      .info-panel {
        position: fixed;
        bottom: 10px;
        left: 10px;
        background-color: rgba(0, 0, 0, 0.6);
        color: white;
        padding: 5px 10px;
        font-family: Arial, sans-serif;
        border-radius: 5px;
        z-index: 100;
        font-size: 14px;
      }
      .loading {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        color: white;
        font-family: Arial, sans-serif;
      }
      .loading-text {
        text-align: center;
      }
      .loading-text h2 {
        margin-bottom: 20px;
      }
      .loading-bar {
        width: 250px;
        height: 20px;
        background-color: #333;
        border-radius: 10px;
        overflow: hidden;
        margin: 0 auto;
      }
      .loading-bar-progress {
        height: 100%;
        background-color: #4CAF50;
        width: 0%;
        transition: width 0.3s;
      }
    </style>
  </head>
  <body>
    <!-- Индикатор загрузки -->
    <div class="loading" id="loading">
      <div class="loading-text">
        <h2>Загрузка AR...</h2>
        <div class="loading-bar">
          <div class="loading-bar-progress" id="loading-bar-progress"></div>
        </div>
        <p id="loading-progress-text">0%</p>
      </div>
    </div>

    <div class="info-panel" id="info-panel">
      Наведите камеру на изображение маркера
    </div>
    
    <!-- MindAR A-Frame сцена -->
    <a-scene 
      mindar-image="imageTargetSrc: targets.mind; autoStart: true; uiLoading: false; uiScanning: false; uiError: false; maxTrack: 1;" 
      color-space="sRGB" 
      embedded
      renderer="colorManagement: true, physicallyCorrectLights" 
      vr-mode-ui="enabled: false">
      
      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>
      
      <a-entity id="target" mindar-image-target="targetIndex: 0">
        <!-- Текст в AR -->
        <a-text
          value="привет из IT Беларуси!"
          color="white"
          position="0 0.5 0"
          align="center"
          scale="0.5 0.5 0.5"
          rotation="-90 0 0">
        </a-text>
        
        <!-- Изображение в AR -->
        <a-plane
          src="image.png"
          position="0 0 0"
          rotation="-90 0 0"
          width="1"
          height="1">
        </a-plane>
        
        <!-- Аудио -->
        <a-entity
          id="belarus-audio"
          sound="src: https://raw.githubusercontent.com/aframevr/aframe/master/examples/basic/audio/click.ogg; autoplay: false; loop: true; volume: 0.5">
        </a-entity>
      </a-entity>
    </a-scene>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Элементы интерфейса
        const loadingEl = document.getElementById('loading');
        const loadingBarEl = document.getElementById('loading-bar-progress');
        const loadingTextEl = document.getElementById('loading-progress-text');
        const infoPanel = document.getElementById('info-panel');
        const sceneEl = document.querySelector('a-scene');
        const audioEl = document.getElementById('belarus-audio');
        
        let isAudioPlaying = false;
        let isTargetFound = false;
        
        // Обработка события прогресса загрузки
        const mindARLib = window.MINDAR.IMAGE;
        mindARLib.MindARImageTarget.prototype.onProgress = (progress) => {
          const percentage = Math.floor(progress * 100);
          loadingBarEl.style.width = `${percentage}%`;
          loadingTextEl.innerHTML = `${percentage}%`;
        };
        
        // Обработка событий сцены
        sceneEl.addEventListener('loaded', function() {
          console.log('A-Frame scene loaded');
        });
        
        // Скрыть загрузчик после загрузки сцены
        sceneEl.addEventListener('renderstart', function() {
          loadingEl.style.display = 'none';
          infoPanel.innerText = 'Наведите камеру на изображение маркера';
        });
        
        // Обработка события обнаружения маркера
        const target = document.getElementById('target');
        target.addEventListener('targetFound', function() {
          isTargetFound = true;
          infoPanel.innerText = 'Маркер найден!';
          
          // Запустить аудио при первом обнаружении
          if (!isAudioPlaying && audioEl.components.sound) {
            audioEl.components.sound.playSound();
            isAudioPlaying = true;
          }
        });
        
        // Обработка события потери маркера
        target.addEventListener('targetLost', function() {
          isTargetFound = false;
          infoPanel.innerText = 'Маркер потерян. Наведите камеру на изображение снова.';
          
          // Приостановить аудио при потере маркера
          if (isAudioPlaying && audioEl.components.sound) {
            audioEl.components.sound.pauseSound();
            isAudioPlaying = false;
          }
        });
      });
    </script>
  </body>
</html> 